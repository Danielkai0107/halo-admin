# Community Portal 使用指南（一頁版）

## 快速開始

### 1. 建立管理員帳號

**Admin**: https://safe-net-tw.web.app/saas-users
- 新增用戶 → 填寫 Email、密碼、選擇社區

### 2. 登入 Community Portal

**Community Portal**: https://safe-net-tw.web.app/community
- 使用剛建立的 Email 和密碼登入

---

## 主要功能

### 長者管理

**新增長者**：
- 點擊「新增長者」→ Modal 彈出
- 填寫資料 + 選擇設備
- 提交 → 完成

**快速編輯**：
- 滑鼠移到長者卡片 → 右上角編輯按鈕
- 點擊 → 修改資料 → 完成

**查看詳情**：
- 點擊長者卡片
- 查看基本資料、設備、足跡

---

### 通知點管理

**設定方式**：
- 前往「通知點」頁面
- 勾選想要的 gateway
- 完成！

**通知格式**（統一）：
```
標題：新偵測通知
內容：{長輩} 出現在 {位置} 附近
```

---

### 查看記錄

**通知記錄**：
- 查看所有 LINE 通知歷史
- 可按日期、長者篩選

**設備足跡**：
- 在長者詳情頁面
- 查看設備活動記錄
- 時間範圍可選（6小時~7天）

---

## 通知流程

```
1. 勾選通知點
2. 長者經過該位置
3. LINE 自動發送通知
4. 記錄顯示在系統中
```

---

## 重要設定

### Gateway 必須有 location

在 Admin 的「GateWay 管理」設定清楚的位置：
- ✅ 「台北市大安區XX路1號」
- ✅ 「社區2樓活動中心」

這會顯示在 LINE 通知中！

### 社區必須有 LINE 設定

在 Admin 的「社區管理」確認：
- lineChannelAccessToken 有值

### 必須有社區成員

- 在 line_users 集合有資料
- 有 lineUserId
- 是 APPROVED 狀態

---

## 測試 LINE 通知

### 使用 Beacon Test

**Admin** → 「Line 通知測試」：
1. 輸入長者的設備資訊（UUID/Major/Minor）
2. 輸入通知點的 gateway serialNumber
3. 點擊「發送測試資料」
4. 等待 5-10 秒
5. 確認 LINE 收到通知

---

## 故障排除

### 沒有收到 LINE 通知？

檢查：
1. 社區有 LINE Channel Access Token？
2. 社區有成員（line_users 有 lineUserId）？
3. 長者有綁定設備？
4. Gateway 有勾選為通知點？
5. Cloud Functions 日誌有錯誤？

```bash
firebase functions:log --only receiveBeaconData
```

### 設備清單是空的？

檢查設備的 tags 欄位是否包含社區 ID。

### 通知點頁面沒有 gateway？

請系統管理員在 Admin 新增 Gateway。

---

## 聯絡資訊

**Firebase 專案**: safe-net-tw  
**Console**: https://console.firebase.google.com/project/safe-net-tw

---

## 完成！

所有功能已上線，可以立即使用。

**Community Portal**: https://safe-net-tw.web.app/community
