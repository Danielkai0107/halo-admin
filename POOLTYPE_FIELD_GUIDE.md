# 設備管理 - poolType 欄位使用指南

**更新日期:** 2026-01-21  
**功能:** 後台設備管理新增 poolType（池類型）欄位

---

## 📋 功能說明

### 什麼是 poolType？

`poolType` 是設備池類型，用於區分設備的使用範圍：

- **🏢 TENANT（社區專用）**: 設備只能分配給社區內的長者使用
- **🌍 PUBLIC（地圖 APP 公用）**: 設備可以被地圖 APP 的一般用戶綁定使用

---

## 🎯 使用場景

### 場景 1: 社區專用設備（TENANT）

**適用對象:**

- 已加入社區的長者
- 需要社區照護人員監控的長者

**設定方式:**

1. 設備池類型選擇 `TENANT（社區專用）`
2. 在「長者管理」頁面分配給長者
3. 只有該社區的照護人員可以查看和管理

### 場景 2: 公共設備（PUBLIC）

**適用對象:**

- 尚未加入社區的一般民眾
- 使用地圖 APP 的自主用戶

**設定方式:**

1. 設備池類型選擇 `PUBLIC（地圖 APP 公用）`
2. 不分配給社區或長者
3. 透過地圖 APP 讓用戶自行綁定

---

## 🖥️ 後台操作指南

### 1. 新增設備時設定 poolType

**步驟:**

1. 進入「設備管理」頁面
2. 點擊「➕ 新增設備」按鈕
3. 填寫基本資料（UUID、Major、Minor）
4. **選擇「設備池類型」:**

   ```
   設備池類型 *
   [TENANT（社區專用）▼]  或  [PUBLIC（地圖 APP 公用）▼]

    PUBLIC 設備可被地圖 APP 用戶綁定
   ```

5. 點擊「新增」

**預設值:** 新設備預設為 `PUBLIC`

---

### 2. 編輯現有設備的 poolType

**步驟:**

1. 在設備列表中找到要編輯的設備
2. 點擊「✏️ 編輯」按鈕
3. 修改「設備池類型」欄位
4. 點擊「更新」

**注意事項:**

- ⚠️ 如果設備已綁定給長者，改為 `PUBLIC` 前請先解綁
- ⚠️ 如果設備已被地圖用戶綁定，改為 `TENANT` 前請先在「地圖 APP 用戶管理」中解綁

---

### 3. 在列表中查看 poolType

設備列表會顯示「池類型」欄位，使用顏色標籤區分：

| 池類型 | 顯示             | 說明                       |
| ------ | ---------------- | -------------------------- |
| PUBLIC | 🌍 PUBLIC (綠色) | 可被地圖 APP 用戶綁定      |
| TENANT | 🏢 TENANT (藍色) | 社區專用設備               |
| 未設定 | ❓ 未設定 (灰色) | 舊設備尚未設定，請編輯補充 |

---

## ⚠️ 重要注意事項

### 設備綁定限制

#### TENANT 設備：

- ✅ 可以在「長者管理」中分配給長者
- ❌ 不能被地圖 APP 用戶綁定
- ✅ 可以在「社區管理」中分配給社區

#### PUBLIC 設備：

- ❌ 不能分配給長者（elderId 必須為 null）
- ✅ 可以被地圖 APP 用戶綁定
- ❌ 不能分配給社區（tenantId 必須為 null）

### 安全檢查

地圖 APP 用戶綁定設備時，API 會自動檢查：

1. ✅ `poolType` 必須為 `'PUBLIC'`
2. ✅ `elderId` 必須為 `null`（不可已綁定長者）
3. ✅ `tenantId` 建議為 `null`（不屬於任何社區）

---

## 🔄 設備類型轉換流程

### 從 TENANT 改為 PUBLIC

**步驟:**

1. 確認設備未綁定長者（elderId = null）
2. 編輯設備，將 poolType 改為 `PUBLIC`
3. 確認 tenantId 為 null
4. 保存

**用途:** 將社區閒置設備開放給一般民眾使用

---

### 從 PUBLIC 改為 TENANT

**步驟:**

1. 在「地圖 APP 用戶管理」中確認設備未被綁定
2. 編輯設備，將 poolType 改為 `TENANT`
3. 可在「社區管理」中分配給社區
4. 在「長者管理」中分配給長者

**用途:** 將公共設備收回作為社區專用

---

## 📊 設備池統計

您可以透過以下方式查看設備池分佈：

### 快速篩選（未來功能）

```
篩選: [全部 ▼]  [🏢 TENANT ▼]  [🌍 PUBLIC ▼]  [❓ 未設定 ▼]
```

### 統計卡片（未來功能）

```
┌──────────────┐  ┌──────────────┐  ┌──────────────┐
│ 社區專用設備 │  │ 公共設備池   │  │ 未設定       │
│ 🏢 TENANT    │  │ 🌍 PUBLIC    │  │ ❓ 需補充    │
│    25 台     │  │    10 台     │  │     3 台     │
└──────────────┘  └──────────────┘  └──────────────┘
```

---

## 🛠️ 常見問題

### Q1: 舊設備沒有 poolType 怎麼辦？

**A:** 舊設備會顯示「❓ 未設定」標籤，請：

1. 點擊「編輯」按鈕
2. 選擇適當的 poolType
3. 保存更新

**建議:**

- 如果設備已分配給長者 → 設為 `TENANT`
- 如果設備閒置或新設備 → 保持 `PUBLIC`（預設值）

---

### Q2: 可以批量設定 poolType 嗎？

**A:** 目前需要逐一編輯。未來可能會新增批量編輯功能。

**臨時方案:** 使用 Firestore Console 批量更新：

```javascript
// 在 Firestore Console 的設備集合中執行
// 將所有未設定的設備設為 TENANT
devices.where("poolType", "==", null).update({ poolType: "TENANT" });
```

---

### Q3: PUBLIC 設備可以分配給長者嗎？

**A:** 不可以。PUBLIC 設備專門給地圖 APP 用戶使用。

**解決方案:**

1. 先將設備改為 `TENANT`
2. 再分配給長者

---

### Q4: 設備池類型可以隨時更改嗎？

**A:** 可以，但請注意：

- 如果設備已被使用（綁定長者或地圖用戶），請先解綁
- 更改後會影響設備的可見性和使用權限

---

## 📚 相關文檔

- `MAP_APP_DEVICE_BINDING_UPDATES.md` - 設備綁定功能更新說明
- `MAP_APP_API_ENDPOINTS.md` - API 文檔
- `UPDATES_SUMMARY.md` - 完整更新總結

---

## ✅ 檢查清單

設定 poolType 前請確認：

**設為 TENANT 前:**

- [ ] 設備未被地圖 APP 用戶綁定
- [ ] 確認要限制在社區內使用

**設為 PUBLIC 前:**

- [ ] 設備未綁定給長者（elderId = null）
- [ ] 設備未分配給社區（tenantId = null）
- [ ] 確認要開放給一般民眾使用

---

**文檔版本:** 1.0.0  
**最後更新:** 2026-01-21
