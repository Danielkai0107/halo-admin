# Community Portal 完整使用指南

## 系統網址
https://safe-net-tw.web.app/community

## 完成時間
2026-01-25

---

## 功能總覽

Community Portal 是社區照護管理系統，提供以下六大功能：

1. **社區概況**（Dashboard）- 數據總覽和報告匯出
2. **長者管理** - 長者資料和設備綁定
3. **設備清單** - 設備狀態查看
4. **通知記錄** - LINE 通知歷史
5. **通知點** - 監控點位設定

---

## 1. 社區概況（Dashboard）

### 訪問方式
- 登入後預設首頁
- 或點擊側邊欄「社區概況」

### 顯示內容

**核心指標（4個卡片）**：
- 總長者數
- 活躍率（24小時有活動的比例）
- 設備覆蓋率（已綁定設備的比例）
- 今日通知數

**預警區塊（2欄）**：
- 不活躍長者預警（紅色，需立即關懷）
- 設備健康狀況（低電量、離線、庫存）

**活動分析（2欄）**：
- 熱門點位 Top 5（近7天）
- 活動趨勢（24小時和7天對比）

**通知點狀態**：
- 啟用通知點數量
- 今日/本週通知統計

### 匯出報告

**功能**：點擊「匯出報告」按鈕

**內容**：
- 完整的統計資料
- 不活躍長者名單（含聯絡方式）
- 熱門點位排行
- 文字格式，適合列印

**用途**：
- 週報/月報製作
- 申請補助佐證
- 工作交接記錄

---

## 2. 長者管理

### Table 顯示

**欄位**：
- 長者（頭像 + 姓名 + 性別/年齡）
- 聯絡方式（電話）
- 設備狀態（已綁定/未綁定 + 設備名）
- 狀態（正常/住院/已故等）
- 最後活動（相對時間，即時更新）
- 操作（編輯/刪除）

### 功能

- 搜尋（姓名/電話/地址）
- 新增長者（Modal + 設備選擇）
- 編輯長者（當前設備顯示）
- 刪除長者
- 點擊行查看詳情

### 長者詳情

- 完整基本資料
- 綁定設備資訊
- **設備足跡**（時間範圍篩選）

---

## 3. 設備清單

### Table 顯示

**欄位**：
- 設備（名稱 + 綁定對象）
- UUID/Major/Minor
- 綁定狀態（彩色標籤）
- 電池（百分比 + 顏色警示）
- 信號（dBm）
- 最後上線（相對時間）
- 操作（查看詳情）

### 功能

- 搜尋（名稱/UUID/MAC/Major/Minor）
- 篩選（全部/已綁定/未綁定）
- 查看詳情（Modal）

**限制**：唯讀模式，不可新增/編輯/刪除

---

## 4. 通知記錄

### 卡片列表顯示

**內容**：
- 長者姓名
- 時間戳記
- 位置（gateway 名稱）
- 類型標籤
- 信號強度
- 通知詳情

### 功能

- 按長者篩選
- 按日期範圍篩選
- 查看所有 LINE 通知歷史

---

## 5. 通知點管理

### Table 顯示已設定的通知點

**欄位**：
- 接收器名稱
- 位置
- 類型
- 序號
- 建立時間
- 操作（刪除）

### 點位設定（Modal）

- 搜尋所有 gateways
- 勾選想要的位置
- 即時生效

### LINE 通知格式

```
標題：新偵測通知
內容：{長輩} 出現在 {位置} 附近
```

---

## 使用流程

### 初次設定（30分鐘）

```
1. 建立帳號
   → Admin: https://safe-net-tw.web.app/saas-users

2. 登入 Community Portal
   → https://safe-net-tw.web.app/community

3. 新增長者
   → 長者管理 → 新增長者 → 填寫資料 + 選擇設備

4. 設定通知點
   → 通知點 → 點位設定 → 勾選重要位置

5. 完成！
```

### 每日例行（5分鐘）

```
1. 查看 Dashboard
   → 關注不活躍長者預警（紅色）
   → 關注設備健康狀況（黃色/紅色）

2. 處理預警
   → 電話關懷不活躍長者
   → 安排更換低電量設備

3. 查看通知記錄
   → 了解今日長者動向

4. 完成
```

### 週報製作（10分鐘）

```
1. 開啟 Dashboard

2. 匯出報告
   → 點擊「匯出報告」

3. 整理週報
   → 複製報告內容
   → 加入文字說明
   → 發送給相關人員

4. 完成
```

---

## 角色權限

### ADMIN 角色

**可以做**：
- ✅ 查看 Dashboard（所有指標）
- ✅ 匯出報告
- ✅ 新增/編輯/刪除長者
- ✅ 設定/刪除通知點
- ✅ 查看所有記錄

### MEMBER 角色

**可以做**：
- ✅ 查看 Dashboard（所有指標）
- ✅ 匯出報告
- ✅ 查看長者列表和詳情
- ✅ 查看設備清單
- ✅ 查看通知記錄和通知點
- ❌ 不能新增/編輯/刪除
- ❌ 不能設定通知點

---

## 側邊欄導航

1. **社區概況**（Dashboard）- 首頁
2. 長者管理
3. 設備清單
4. 通知記錄
5. 通知點

---

## 資料即時性

### 即時更新

**這些會即時更新**：
- 長者列表
- 設備列表
- 通知點列表
- 長者的最後活動時間

使用 Firestore onSnapshot 訂閱。

### 手動更新

**這些需要重新整理**：
- Dashboard 統計資料
- 通知記錄
- 設備足跡

重新進入頁面或點擊重新整理。

---

## 關鍵數據定義

| 指標 | 定義 | 更新方式 |
|------|------|---------|
| 總長者數 | 社區內 isActive=true 的長者 | 即時 |
| 活躍率 | 24小時內有活動的長者比例 | 手動 |
| 設備覆蓋率 | 已綁定設備的長者比例 | 即時 |
| 不活躍長者 | 超過24小時未活動 | 手動 |
| 低電量設備 | 電池少於20% | 即時 |
| 離線設備 | 超過24小時未上線 | 手動 |
| 最後活動 | 長者設備最後感應時間 | 即時 |

---

## 系統價值

### 對里長

**日常管理**：
- 一目了然的安全狀況
- 即時預警需關懷對象
- 量化工作成果

**對外溝通**：
- 報告展示服務成效
- 申請資源的數據支持
- 家屬信任的建立

### 對協會

**運維管理**：
- 設備維護排程
- 物資庫存管理
- 系統健康監控

**服務規劃**：
- 了解長者活動模式
- 調整服務據點
- 優化通知設定

---

## 建議使用節奏

### 每日（5分鐘）

- 早上：查看 Dashboard 預警
- 處理：關懷不活躍長者
- 晚上：檢查今日通知記錄

### 每週（15分鐘）

- 匯出報告
- 檢討本週數據
- 調整通知點設定（如需要）

### 每月（30分鐘）

- 匯出報告
- 分析月度趨勢
- 製作月報
- 規劃下月工作

---

## 完成

Community Portal 所有功能已完成：

1. ✅ 社區概況（Dashboard + 報告匯出）
2. ✅ 長者管理（Table + Modal）
3. ✅ 設備清單（Table + 詳情）
4. ✅ 通知記錄（查詢修正）
5. ✅ 通知點（Table + Modal）

**立即使用**：https://safe-net-tw.web.app/community
