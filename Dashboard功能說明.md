# Community Portal Dashboard 功能說明

## 部署時間
2026-01-25 23:02

## 訪問方式
https://safe-net-tw.web.app/community/dashboard

**預設首頁**：登入後自動導航到 Dashboard

---

## Dashboard 設計理念

### 專業簡約風格

**設計原則**：
- 清晰的資訊層次
- 使用圖示增強識別
- 顏色有意義（綠色=正常，黃色=警告，紅色=緊急）
- 卡片式佈局，現代化風格
- 無 emoji，專業呈現

---

## 核心指標（頂部卡片）

### 1. 總長者數
- **數字**：社區內登記的長者總數
- **圖示**：Users（藍色）
- **用途**：了解服務涵蓋人數

### 2. 活躍率
- **數字**：百分比（活躍長者/總長者）
- **顯示**：X / Y 位
- **圖示**：Activity（綠色）
- **定義**：24小時內有活動記錄的長者
- **用途**：整體安全狀況的關鍵指標

### 3. 設備覆蓋率
- **數字**：百分比（已綁定設備/總長者）
- **顯示**：X / Y 個
- **圖示**：Smartphone（紫色）
- **用途**：評估設備資源是否充足

### 4. 今日通知數
- **數字**：今日發送的 LINE 通知次數
- **顯示**：本週 X 次
- **圖示**：Bell（橘色）
- **用途**：了解系統運作頻率

---

## 預警區塊（中間兩欄）

### 左欄：不活躍長者預警

**用途**：最重要的安全預警

**顯示內容**：
- 超過 24 小時未活動的長者列表
- 顯示姓名、未活動時數、電話
- 紅色底色，警告圖示
- 最多顯示 10 位

**如果無預警**：
- 綠色底色
- 顯示「所有長者都有正常活動」

**價值**：
- 里長可立即指派志工關懷
- 預防孤獨死或意外
- 優先處理清單

### 右欄：設備健康狀況

**用途**：確保系統正常運作

**三個指標**：

**1. 低電量預警（少於20%）**
- 黃色底色（有問題時）
- 顯示需要更換電池的設備數量
- 提前安排維護

**2. 離線設備（超過24小時）**
- 紅色底色（有問題時）
- 顯示可能故障的設備數量
- 檢查設備或接收器

**3. 未綁定設備庫存**
- 灰色底色
- 顯示可用設備數量
- 管理物資庫存

---

## 活動分析（下方兩欄）

### 左欄：熱門點位（近7天）

**用途**：了解長者常去哪裡

**顯示內容**：
- Top 5 最多感應的點位
- 顯示排名、點位名稱、感應次數
- 灰色底色卡片

**價值**：
- 了解長者活動模式
- 評估社區活動成效
- 規劃服務據點

**範例**：
```
1. 活動中心 - 125 次感應
2. 社區大門 - 98 次感應
3. 公園 - 67 次感應
4. 餐廳 - 45 次感應
5. 市場 - 32 次感應
```

### 右欄：活動趨勢

**用途**：了解活動頻率變化

**顯示內容**：
- 近24小時活動次數（藍色進度條）
- 近7天活動次數（綠色進度條）
- 平均每日活動次數（計算值）

**價值**：
- 評估社區活躍度
- 比較不同時期的差異
- 季節性變化觀察

---

## 通知點狀態（底部）

**用途**：通知服務運作摘要

**三個指標**：
- **啟用通知點**：目前設定的通知點數量
- **今日通知**：今天發送的通知次數
- **本週通知**：本週累計通知次數

**顏色區分**：
- 藍色底：啟用通知點
- 藍色底：今日通知
- 綠色底：本週通知

---

## 匯出報告功能

### 點擊「匯出報告」按鈕

**產生內容**：
```
社區照護系統報告
=====================================

社區名稱：大安社區
報告日期：2026/01/25

一、長者服務統計
-------------------------------------
總長者數：50 位
活躍長者：45 位
不活躍長者：5 位
設備覆蓋率：90%

二、設備運作狀況
-------------------------------------
已綁定設備：45 個
未綁定設備：5 個
低電量預警：2 個
離線設備：1 個

三、通知服務統計
-------------------------------------
今日通知數：12 次
本週通知數：78 次
啟用通知點：3 個

四、活動統計
-------------------------------------
24小時活動次數：45 次
7天活動次數：312 次

五、不活躍長者名單
-------------------------------------
1. 王小明（48小時未活動）- 0912345678
2. 李奶奶（36小時未活動）- 0923456789
...

六、熱門點位統計（近7天）
-------------------------------------
1. 活動中心 - 125 次
2. 社區大門 - 98 次
3. 公園 - 67 次
...

=====================================
報告結束
```

**檔案格式**：
- 純文字檔（.txt）
- UTF-8 編碼
- 適合列印或轉發

**檔案名稱**：
```
社區照護報告_{社區名稱}_{日期}.txt
```

---

## 使用場景

### 場景 1：每日晨會

**里長每天早上**：
1. 開啟 Dashboard
2. 查看「不活躍長者預警」
3. 指派志工電話關懷或訪視
4. 查看「設備健康狀況」
5. 安排維護或更換

### 場景 2：週報/月報

**協會每週/月**：
1. 開啟 Dashboard
2. 點擊「匯出報告」
3. 下載報告檔案
4. 附加到週報或月報中
5. 提交給上級或政府單位

### 場景 3：服務檢討

**季度檢討會議**：
1. 查看「熱門點位」
2. 評估哪些地點受歡迎
3. 調整活動安排或服務據點
4. 查看「活動趨勢」
5. 比較不同時期的差異

### 場景 4：申請補助

**年度申請時**：
1. 匯出報告
2. 展示服務涵蓋人數
3. 展示通知次數（主動預防）
4. 展示設備使用率
5. 量化服務成效

---

## 資料更新機制

### 即時計算

Dashboard 資料是**即時計算**的：
- 每次進入頁面重新查詢
- 點擊「重新整理資料」按鈕更新
- 使用最新的 Firestore 資料

### 查詢範圍

為了效能考量，有以下限制：
- 不活躍長者：查詢所有
- 熱門點位：查詢前 30 位有設備的長者
- 活動統計：查詢前 50 位有設備的長者
- 每個長者最多查 100 筆活動記錄

**大型社區建議**：
- 使用快取機制
- 或改為定時統計（每小時計算一次）

---

## 顏色語意

### 狀態顏色

- **藍色**：資訊性（總長者數、通知點）
- **綠色**：正常/良好（活躍率、正常狀態）
- **紫色**：中性指標（設備覆蓋率）
- **橘色**：活動指標（通知數）
- **黃色**：警告（低電量）
- **紅色**：緊急（離線設備、不活躍長者）

### 視覺層次

**重要性由高到低**：
1. 紅色區塊（不活躍長者）→ 立即處理
2. 黃色區塊（低電量）→ 近期處理
3. 核心指標（頂部卡片）→ 整體狀況
4. 活動分析（中下方）→ 趨勢了解

---

## 報告用途

### 對內使用

**日常管理**：
- 每日巡視 Dashboard
- 關注預警區塊
- 追蹤活動趨勢

**工作交接**：
- 匯出當日報告
- 記錄處理情況
- 交班給下一位

### 對外使用

**上級報告**：
- 定期匯出報告
- 展示服務成效
- 量化工作成果

**政府單位**：
- 申請補助時附上
- 展示科技應用成效
- 證明服務品質

**家屬溝通**：
- 展示社區照護能力
- 說明監控機制
- 建立信任

---

## 操作說明

### 查看 Dashboard

1. 登入 Community Portal
2. 自動導航到 Dashboard（或點擊側邊欄「社區概況」）
3. 查看各項指標

### 重新整理資料

- 點擊頁面底部「重新整理資料」連結
- 或重新整理瀏覽器（F5）

### 匯出報告

1. 點擊右上角「匯出報告」按鈕
2. 瀏覽器自動下載 .txt 檔案
3. 開啟檔案查看或分享

---

## 技術實作

### dashboardService.ts

**三個主要方法**：

**1. getStats(tenantId)**
- 計算所有核心指標
- 並行查詢 elders、devices、通知點
- 統計活動和通知次數

**2. getInactiveElders(tenantId, hours)**
- 取得不活躍長者列表
- 計算未活動時數
- 排序（最久未活動在前）

**3. getLocationHotspots(tenantId, days)**
- 統計各點位的感應次數
- 查詢近 N 天的活動記錄
- 排序（最多次數在前）

### 效能優化

**查詢限制**：
- 熱門點位：最多查詢 30 位長者
- 活動統計：最多查詢 50 位長者
- 每位長者：最多 100 筆活動

**並行查詢**：
```typescript
Promise.all([
  getStats(),
  getInactiveElders(),
  getLocationHotspots(),
])
```

三個查詢同時執行，加快載入速度。

---

## 未來優化建議

### 短期

1. **圖表視覺化**
   - 使用 Chart.js 或 Recharts
   - 活動趨勢折線圖
   - 熱門點位柱狀圖

2. **更多匯出格式**
   - PDF 格式（更專業）
   - Excel 格式（可分析）
   - CSV 格式（可匯入其他系統）

### 中期

1. **時間範圍選擇**
   - 可選擇查看特定日期範圍
   - 比較不同時期的資料

2. **快取機制**
   - 定時計算統計資料
   - 儲存到 Firestore
   - Dashboard 讀取快取

3. **即時圖表**
   - 今日活動曲線
   - 通知發送時間分布
   - 長者出沒熱點地圖

### 長期

1. **AI 預測**
   - 預測未來可能不活躍的長者
   - 異常行為偵測

2. **對比分析**
   - 與上週/上月比較
   - 趨勢箭頭（上升/下降）

3. **自訂報告**
   - 選擇要包含的指標
   - 設定報告格式
   - 排程自動產生

---

## 數據說明

### 不活躍長者定義

**條件**：
- `lastActivityAt` 為空（從未活動）
- 或距離現在超過 24 小時

**排除**：
- `isActive = false` 的長者（已刪除）
- 未綁定設備的長者仍會計入（因為可能是設備問題）

### 活動統計範圍

**24小時活動**：
- 從現在往前推 24 小時
- 計算所有感應次數

**7天活動**：
- 從現在往前推 7 天
- 計算所有感應次數

**平均每日**：
- 7天活動 ÷ 7

### 通知統計

**今日通知**：
- 從今天 00:00:00 開始
- 到現在為止的通知次數

**本週通知**：
- 從 7 天前開始
- 到現在為止的通知次數

---

## 報告內容解讀

### 第一部分：長者服務統計

**關鍵指標**：
- 總長者數：服務涵蓋範圍
- 活躍長者：正常活動人數
- 不活躍長者：需要關注人數
- 設備覆蓋率：硬體資源充足度

**解讀範例**：
```
總長者數：50 位
活躍長者：45 位（90% 活躍率）
→ 整體狀況良好

設備覆蓋率：90%
→ 還有 5 位長者未綁定設備，需要補足
```

### 第二部分：設備運作狀況

**關鍵指標**：
- 低電量預警：需要更換電池
- 離線設備：可能故障
- 未綁定設備：可用庫存

**解讀範例**：
```
低電量預警：2 個
→ 需要安排更換這 2 個設備的電池

離線設備：1 個
→ 可能是設備故障或接收器問題，需要檢查
```

### 第三部分：通知服務統計

**關鍵指標**：
- 今日/本週通知數：系統運作頻率
- 啟用通知點：監控點位數量

**解讀範例**：
```
今日通知數：12 次
本週通知數：78 次
→ 平均每天約 11 次通知，運作正常

啟用通知點：3 個
→ 監控社區大門、活動中心、公園
```

### 第四部分：活動統計

**關鍵指標**：
- 24小時/7天活動次數
- 反映社區整體活躍度

### 第五部分：不活躍長者名單

**包含資訊**：
- 姓名
- 未活動時數
- 聯絡電話

**用途**：
- 直接提供關懷名單
- 志工可按此清單逐一聯絡

### 第六部分：熱門點位統計

**包含資訊**：
- 排名
- 點位名稱和位置
- 感應次數

**用途**：
- 了解長者活動熱點
- 評估社區規劃

---

## 使用建議

### 每日例行

**建議時間**：每天早上 9:00

**查看項目**：
1. 不活躍長者預警（紅色區塊）
2. 設備健康狀況（黃色/紅色警告）
3. 今日通知數（確認系統運作）

**處理流程**：
- 有紅色預警 → 立即處理
- 有黃色警告 → 安排處理
- 全綠色 → 正常運作

### 週報製作

**建議時間**：每週一

**操作**：
1. 開啟 Dashboard
2. 匯出報告
3. 整理成週報格式
4. 發送給相關人員

### 月報製作

**建議時間**：每月1日

**操作**：
1. 匯出報告
2. 比較上月資料
3. 分析趨勢變化
4. 製作月報

---

## 完成

Dashboard 功能已完成並部署：
- ✅ 專業簡約設計
- ✅ 核心指標卡片
- ✅ 預警區塊
- ✅ 活動分析
- ✅ 報告匯出

立即查看：`https://safe-net-tw.web.app/community/dashboard`

登入後自動顯示，或點擊側邊欄「社區概況」。
